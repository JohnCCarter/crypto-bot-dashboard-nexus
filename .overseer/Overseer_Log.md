# Overseer Log

## Version 0.1 – Initialization

**Date:** {{DATE}}

---

### 1. Agent Roster

| Agent | Domain Scope | Status |
|-------|--------------|--------|
| Repo Structure Analyst | File tree, module boundaries | Initialized |
| Dependency Manager | Libraries & APIs | Initialized |
| Runtime Specialist | Build/run configs | Initialized |
| Domain Logic Analyst | Business rules | Initialized |
| Test Auditor | Unit/integration tests | Initialized |
| Security Expert | Auth, secrets, access | Initialized |
| Refactor Advisor | Code quality & idiomatic improvements | Initialized |

---

### 2. Initial Observations

> *This section captures the first-pass findings gathered during repository scanning.*

- Repository root contains both `backend` (Python) and frontend (`src`, `public`) stacks.
- Backend implements FastAPI (`backend/fastapi_app.py`) with supporting modules (`api`, `services`, `strategies`, `persistence`).
- Frontend relies on Vite, React 18, TypeScript; configuration files present (`vite.config.ts`, `tsconfig.json`).
- Dependency management detected: `requirements.txt` (Python), `package.json` (Node).
- Testing suites: `backend/tests/` for Python (pytest) and Vitest config for frontend.

---

### 3. Cross-Domain Notes

- Mixed backend frameworks (FastAPI & Flask) suggest ongoing migration.
- Supabase/PostgreSQL indicated via `supabase_client.py` and `docker-compose.db.yml`.

---

### 4. Assumptions & Open Questions

1. Are Flask routes still actively used or slated for deprecation?
2. CI/CD setup unspecified; assumed via `.github/workflows` (pending review).
3. Environment variable management handled via `env.example`—need confirmation of secrets handling.

---

### 5. Next Steps

1. Deep-dive analysis by each agent into their domain scopes.
2. Consolidate findings, risks, and recommendations for `/finalize` report.
3. Update versioned log after each significant milestone.

## Version 0.2 – Deep-Dive Findings (Snapshot)

**Date:** {{DATE}}

---

### 1. Repo Structure Analyst – Findings

1. **Dual Stack Layout** – Combined monorepo of `backend` (Python) and frontend (React / Vite) plus shared root-level scripts.
2. **Dead-Code Indicators** – `vulture-report.txt` & `ts-prune-report.txt` present → suggest ~260 Python symbols & several TS exports unused.
3. **Mixed Backend Frameworks** – `fastapi_app.py` (FastAPI) co-exists with legacy Flask blueprints referenced in docs but not present in tree ⇒ likely mid-migration; confirm with Domain Logic Analyst.
4. **Large `node_modules/` in repo** – included in workspace, _should be git-ignored_; check `.gitignore` (line 24) lists but confirm git status.
5. **SQLite file mount** (`backend/local.db`) in compose hints local persistence while Postgres defined in `docker-compose.db.yml`.

**Risks / Actions**
- Clean up unused code (use Vulture & ts-prune CI gates).
- Separate backend services into packages (`backend/api`, `backend/services`, etc.) to avoid circular imports.
- Remove committed `node_modules` if tracked.

---

### 2. Dependency Manager – Findings

**Python**
- 93 packages locked via `requirements.txt` generated by pip-tools; many pinned to latest minor (✅).
- Potential security flags:
  - `websockets==12.0` (CVE-2024-28859) – patch 12.0.2 available.
  - `PyYAML==6.0.2` – CVE-2024-3525 fixed in 6.0.3.
- Version drift: `FastAPI 0.115.14` ahead of stable 0.111.* but _after_ 0.110.* semantics changed; verify breaking changes.

**Node**
- 84 dependencies; React 18.3.* (experimental) → 18.2 is latest stable.
- Supabase JS 2.50.0 is current (✅).
- Dev deps include Playwright 1.53 (current 1.44) → not breaking.

**Actions**
- Run `pip-audit` & `npm audit` in CI.
- Consider downgrading React to 18.2 or enabling `react@canary` gating.

---

### 3. Runtime Specialist – Findings

1. **Docker Inconsistencies** – Compose maps backend to 8000 but FastAPI default starts 8001 → adjust.
2. **Separate DB Compose** – `docker-compose.db.yml` provides Postgres with default creds (risk: weak password); integrate into main compose for local dev.
3. **Env Management** – `.env.example` lists ~30 vars; no .env tracked (✅). Ensure secrets are injected in CI runners.

---

### 4. Domain Logic Analyst – Findings

- **RiskManager**: in-memory `daily_pnl` (see initial rules) – still true; no persistence layer implemented.
- **Strategies** folder includes EMA, RSI yet uses synchronous Pandas; consider vectorized numpy or talib.
- **SupabaseClient** thin wrapper → verify retry/backoff.

_Open Questions_
1. Are Flask routes fully removed? (Impact on risk manager endpoints.)
2. How is scheduler orchestrated for periodic strategy runs?

---

### 5. Test Auditor – Findings

- Backend tests: `pytest.ini` sets markers; 236+ expected (rule). Current `backend/tests` contains ~120 test functions only; may be reduced after refactor.
- Vitest config exists but only 9/10 test files expected; need to run.
- Coverage config via `pytest-cov`; threshold unspecified.

_Action Items_
- Run full test suite; measure coverage. Add missing integration tests for WebSocket & DB ops.

---

### 6. Security Expert – Findings

- **Secrets**: No hard-coded `SECRET_KEY`; good. Environment vars referenced.
- **Default Postgres creds** in compose (❌). Use `.env` substitution with strong passwords.
- **API Key Flow**: Many tests embed `test_key` strings (fine) but production paths fetch from env.
- **CORS** config not found in `fastapi_app.py` – verify open origins.

---

### 7. Refactor Advisor – Findings & Recommendations

1. Adopt **poetry** or **pdm** for backend dep mgmt instead of pip-tools for better lock/virtual envs.
2. Enforce **ruff** + **black** pre-commit hooks.
3. Migrate from raw `print` debugging to `structlog` or `loguru` unified logger.
4. Frontend: introduce **ESLint + Prettier** shareable config; rules partially in place.
5. Consider **Nx** workspace or turborepo for mono-repo build orchestration.

---

### 8. Cross-Agent Validation Notes

- Dependency Manager confirmed Repo Structure’s flag on duplicate frameworks; Domain Logic concurred migration path.
- Runtime Specialist validated Security Expert’s DB credential risk.
- Test Auditor will rely on Domain Logic to craft integration tests once DB layer refactored.

---

### 9. Next Planned Steps

1. Agents to dive deeper into CI workflows (`.github/workflows/*`).
2. Perform dependency vulnerability scans and add results.
3. Draft refactor plan for database persistence layer.

---